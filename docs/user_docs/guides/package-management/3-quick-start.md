# Quick Start

## Init an empty kcl package

First, create an empty folder for the KCL package and go into that folder.

```shell
mkdir my_package # create an empty folder 'my_package'
cd my_package # go into the folder 'my_package'
```

Create a new kcl package named `my_package`.

```shell
kpm init
```

`kpm` will create two kcl package configuration files: `kcl.mod` and `kcl.mod.lock` in the directory where you executed the command.

```shell
- my_package
      |- kcl.mod
      |- kcl.mod.lock
      |- # You can write your kcl program directly in this directory.
```

`kcl.mod.lock` is the file generated by `kpm` to fix the dependency version. Do not modify this file manually.

`kpm` initializes `kcl.mod` for an empty project as shown below:

```shell
[package]
name = "my_package"
edition = "0.0.1"
version = "0.0.1"
```

## Add a dependency from Git Registry

If you need to use the KCL model in [Konfig](https://github.com/awesome-kusion/konfig.git) to write the kcl program.

```shell
kpm add -git https://github.com/awesome-kusion/konfig.git -tag v0.0.1
```

You can see that `kpm` adds the dependency you just added to kcl.mod.

```shell
[package]
name = "my_package"
edition = "0.0.1"
version = "0.0.1"

[dependencies]
# 'konfig' is the package name
# If you want to use the contents of this package, 
# you need to write the import statment with the package name 'konfig' as the prefix.
konfig = { git = "https://github.com/awesome-kusion/konfig.git", tag = "v0.0.1" }
```

## Write a kcl program that uses the content in `konfig`

Create the `main.k` file in the current package.

```shell
- my_package
      |- kcl.mod
      |- kcl.mod.lock
      |- main.k # Your KCL program.
```

And write the following into the `main.k` file.

```kcl
import konfig.base.pkg.kusion_kubernetes.api.apps.v1 as apps

demo = apps.Deployment {
    metadata.name = "nginx-deployment"
    spec = {
        replicas = 3
        selector.matchLabels.app = "nginx"
        template.metadata.labels = selector.matchLabels
        template.spec.containers = [
            {
                name = selector.matchLabels.app
                image = "nginx:1.14.2"
                ports = [
                    {containerPort = 80}
                ]
            }
        ]
    }
}
```

## Compile the kcl package

You can use the command to compile the `main.k` file you just wrote.

```shell
kcl main.k -S demo
```

If you get the following output, congratulations !, you have successfully compiled your kcl package with `kpm`.

```shell
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - image: "nginx:1.14.2"
          name: nginx
          ports:
            - containerPort: 80
```

## Package your current kcl package with its dependencies

You can use the command `kpm pkg` to package your current kcl package with its dependencies.

```shell
kpm pkg --target my_package.tar
```

After this command is executed, a tar package will be packaged in the `my_package.tar` directory. And all the dependencies for `my_package` will be stored in the `vendor` subdirectory.

```shell
- my_package
      |- kcl.mod
      |- kcl.mod.lock
      |- main.k
      |- my_package.tar # The file (*.tar) packaged by kpm.
      |- vendor # All the dependencies for `my_package` will be stored in the `vendor` 
            |- konfig_v0.0.1
```
